(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){SortedSet=require("collections/sorted-set")},{"collections/sorted-set":17}],2:[function(require,module,exports){"use strict";var Shim=require("./shim");var GenericCollection=require("./generic-collection");var GenericMap=require("./generic-map");var PropertyChanges=require("./listen/property-changes");module.exports=Dict;function Dict(values,getDefault){if(!(this instanceof Dict)){return new Dict(values,getDefault)}getDefault=getDefault||Function.noop;this.getDefault=getDefault;this.store={};this.length=0;this.addEach(values)}Dict.Dict=Dict;function mangle(key){return"$"+key}function unmangle(mangled){return mangled.slice(1)}Object.addEach(Dict.prototype,GenericCollection.prototype);Object.addEach(Dict.prototype,GenericMap.prototype);Object.addEach(Dict.prototype,PropertyChanges.prototype);Dict.prototype.constructClone=function(values){return new this.constructor(values,this.getDefault)};Dict.prototype.assertString=function(key){if(typeof key!=="string"){throw new TypeError("key must be a string but Got "+key)}};Dict.prototype.get=function(key,defaultValue){this.assertString(key);var mangled=mangle(key);if(mangled in this.store){return this.store[mangled]}else if(arguments.length>1){return defaultValue}else{return this.getDefault(key)}};Dict.prototype.set=function(key,value){this.assertString(key);var mangled=mangle(key);if(mangled in this.store){if(this.dispatchesBeforeMapChanges){this.dispatchBeforeMapChange(key,this.store[mangled])}this.store[mangled]=value;if(this.dispatchesMapChanges){this.dispatchMapChange(key,value)}return false}else{if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(key,undefined)}this.length++;this.store[mangled]=value;if(this.dispatchesMapChanges){this.dispatchMapChange(key,value)}return true}};Dict.prototype.has=function(key){this.assertString(key);var mangled=mangle(key);return mangled in this.store};Dict.prototype["delete"]=function(key){this.assertString(key);var mangled=mangle(key);if(mangled in this.store){if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(key,this.store[mangled])}delete this.store[mangle(key)];this.length--;if(this.dispatchesMapChanges){this.dispatchMapChange(key,undefined)}return true}return false};Dict.prototype.clear=function(){var key,mangled;for(mangled in this.store){key=unmangle(mangled);if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(key,this.store[mangled])}delete this.store[mangled];if(this.dispatchesMapChanges){this.dispatchMapChange(key,undefined)}}this.length=0};Dict.prototype.reduce=function(callback,basis,thisp){for(var mangled in this.store){basis=callback.call(thisp,basis,this.store[mangled],unmangle(mangled),this)}return basis};Dict.prototype.reduceRight=function(callback,basis,thisp){var self=this;var store=this.store;return Object.keys(this.store).reduceRight(function(basis,mangled){return callback.call(thisp,basis,store[mangled],unmangle(mangled),self)},basis)};Dict.prototype.one=function(){var key;for(key in this.store){return this.store[key]}};Dict.prototype.toJSON=function(){return this.toObject()}},{"./generic-collection":3,"./generic-map":4,"./listen/property-changes":9,"./shim":16}],3:[function(require,module,exports){"use strict";module.exports=GenericCollection;function GenericCollection(){throw new Error("Can't construct. GenericCollection is a mixin.")}GenericCollection.prototype.addEach=function(values){if(values&&Object(values)===values){if(typeof values.forEach==="function"){values.forEach(this.add,this)}else if(typeof values.length==="number"){for(var i=0;i<values.length;i++){this.add(values[i],i)}}else{Object.keys(values).forEach(function(key){this.add(values[key],key)},this)}}else if(values&&typeof values.length==="number"){for(var i=0;i<values.length;i++){this.add(values[i],i)}}return this};GenericCollection.prototype.deleteEach=function(values,equals){values.forEach(function(value){this["delete"](value,equals)},this);return this};GenericCollection.prototype.forEach=function(callback){var thisp=arguments[1];return this.reduce(function(undefined,value,key,object,depth){callback.call(thisp,value,key,object,depth)},undefined)};GenericCollection.prototype.map=function(callback){var thisp=arguments[1];var result=[];this.reduce(function(undefined,value,key,object,depth){result.push(callback.call(thisp,value,key,object,depth))},undefined);return result};GenericCollection.prototype.enumerate=function(start){if(start==null){start=0}var result=[];this.reduce(function(undefined,value){result.push([start++,value])},undefined);return result};GenericCollection.prototype.group=function(callback,thisp,equals){equals=equals||Object.equals;var groups=[];var keys=[];this.forEach(function(value,key,object){var key=callback.call(thisp,value,key,object);var index=keys.indexOf(key,equals);var group;if(index===-1){group=[];groups.push([key,group]);keys.push(key)}else{group=groups[index][1]}group.push(value)});return groups};GenericCollection.prototype.toArray=function(){return this.map(Function.identity)};GenericCollection.prototype.toObject=function(){var object={};this.reduce(function(undefined,value,key){object[key]=value},undefined);return object};GenericCollection.prototype.filter=function(callback){var thisp=arguments[1];var result=this.constructClone();this.reduce(function(undefined,value,key,object,depth){if(callback.call(thisp,value,key,object,depth)){result.add(value,key)}},undefined);return result};GenericCollection.prototype.every=function(callback){var thisp=arguments[1];return this.reduce(function(result,value,key,object,depth){return result&&callback.call(thisp,value,key,object,depth)},true)};GenericCollection.prototype.some=function(callback){var thisp=arguments[1];return this.reduce(function(result,value,key,object,depth){return result||callback.call(thisp,value,key,object,depth)},false)};GenericCollection.prototype.all=function(){return this.every(Boolean)};GenericCollection.prototype.any=function(){return this.some(Boolean)};GenericCollection.prototype.min=function(compare){compare=compare||this.contentCompare||Object.compare;var first=true;return this.reduce(function(result,value){if(first){first=false;return value}else{return compare(value,result)<0?value:result}},undefined)};GenericCollection.prototype.max=function(compare){compare=compare||this.contentCompare||Object.compare;var first=true;return this.reduce(function(result,value){if(first){first=false;return value}else{return compare(value,result)>0?value:result}},undefined)};GenericCollection.prototype.sum=function(zero){zero=zero===undefined?0:zero;return this.reduce(function(a,b){return a+b},zero)};GenericCollection.prototype.average=function(zero){var sum=zero===undefined?0:zero;var count=zero===undefined?0:zero;this.reduce(function(undefined,value){sum+=value;count+=1},undefined);return sum/count};GenericCollection.prototype.concat=function(){var result=this.constructClone(this);for(var i=0;i<arguments.length;i++){result.addEach(arguments[i])}return result};GenericCollection.prototype.flatten=function(){var self=this;return this.reduce(function(result,array){array.forEach(function(value){this.push(value)},result,self);return result},[])};GenericCollection.prototype.zip=function(){var table=Array.prototype.slice.call(arguments);table.unshift(this);return Array.unzip(table)};GenericCollection.prototype.join=function(delimiter){return this.reduce(function(result,string){if(result===void 0){return string}else{return result+delimiter+string}},void 0)};GenericCollection.prototype.sorted=function(compare,by,order){compare=compare||this.contentCompare||Object.compare;if(compare.by){by=compare.by;compare=compare.compare||this.contentCompare||Object.compare}else{by=by||Function.identity}if(order===undefined)order=1;return this.map(function(item){return{by:by(item),value:item}}).sort(function(a,b){return compare(a.by,b.by)*order}).map(function(pair){return pair.value})};GenericCollection.prototype.reversed=function(){return this.constructClone(this).reverse()};GenericCollection.prototype.clone=function(depth,memo){if(depth===undefined){depth=Infinity}else if(depth===0){return this}var clone=this.constructClone();this.forEach(function(value,key){clone.add(Object.clone(value,depth-1,memo),key)},this);return clone};GenericCollection.prototype.only=function(){if(this.length===1){return this.one()}};GenericCollection.prototype.iterator=function(){return this.iterate.apply(this,arguments)};require("./shim-array")},{"./shim-array":12}],4:[function(require,module,exports){"use strict";var Object=require("./shim-object");var MapChanges=require("./listen/map-changes");var PropertyChanges=require("./listen/property-changes");module.exports=GenericMap;function GenericMap(){throw new Error("Can't construct. GenericMap is a mixin.")}Object.addEach(GenericMap.prototype,MapChanges.prototype);Object.addEach(GenericMap.prototype,PropertyChanges.prototype);GenericMap.prototype.isMap=true;GenericMap.prototype.addEach=function(values){if(values&&Object(values)===values){if(typeof values.forEach==="function"){if(values.isMap===true){values.forEach(function(value,key){this.set(key,value)},this)}else{values.forEach(function(pair){this.set(pair[0],pair[1])},this)}}else if(typeof values.length==="number"){for(var i=0;i<values.length;i++){this.add(values[i],i)}}else{Object.keys(values).forEach(function(key){this.set(key,values[key])},this)}}else if(values&&typeof values.length==="number"){for(var i=0;i<values.length;i++){this.add(values[i],i)}}return this};GenericMap.prototype.get=function(key,defaultValue){var item=this.store.get(new this.Item(key));if(item){return item.value}else if(arguments.length>1){return defaultValue}else{return this.getDefault(key)}};GenericMap.prototype.set=function(key,value){var item=new this.Item(key,value);var found=this.store.get(item);var grew=false;if(found){if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(key,found.value)}found.value=value;if(this.dispatchesMapChanges){this.dispatchMapChange(key,value)}}else{if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(key,undefined)}if(this.store.add(item)){this.length++;grew=true}if(this.dispatchesMapChanges){this.dispatchMapChange(key,value)}}return grew};GenericMap.prototype.add=function(value,key){return this.set(key,value)};GenericMap.prototype.has=function(key){return this.store.has(new this.Item(key))};GenericMap.prototype["delete"]=function(key){var item=new this.Item(key);if(this.store.has(item)){var from=this.store.get(item).value;if(this.dispatchesMapChanges){this.dispatchBeforeMapChange(key,from)}this.store["delete"](item);this.length--;if(this.dispatchesMapChanges){this.dispatchMapChange(key,undefined)}return true}return false};GenericMap.prototype.clear=function(){var keys;if(this.dispatchesMapChanges){this.forEach(function(value,key){this.dispatchBeforeMapChange(key,value)},this);keys=this.keys()}this.store.clear();this.length=0;if(this.dispatchesMapChanges){keys.forEach(function(key){this.dispatchMapChange(key)},this)}};GenericMap.prototype.reduce=function(callback,basis,thisp){return this.store.reduce(function(basis,item){return callback.call(thisp,basis,item.value,item.key,this)},basis,this)};GenericMap.prototype.reduceRight=function(callback,basis,thisp){return this.store.reduceRight(function(basis,item){return callback.call(thisp,basis,item.value,item.key,this)},basis,this)};GenericMap.prototype.keys=function(){return this.map(function(value,key){return key})};GenericMap.prototype.values=function(){return this.map(Function.identity)};GenericMap.prototype.entries=function(){return this.map(function(value,key){return[key,value]})};GenericMap.prototype.items=function(){return this.entries()};GenericMap.prototype.equals=function(that,equals){equals=equals||Object.equals;if(this===that){return true}else if(that&&typeof that.every==="function"){return that.length===this.length&&that.every(function(value,key){return equals(this.get(key),value)},this)}else{var keys=Object.keys(that);return keys.length===this.length&&Object.keys(that).every(function(key){return equals(this.get(key),that[key])},this)}};GenericMap.prototype.toJSON=function(){return this.entries()};GenericMap.prototype.Item=Item;function Item(key,value){this.key=key;this.value=value}Item.prototype.equals=function(that){return Object.equals(this.key,that.key)&&Object.equals(this.value,that.value)};Item.prototype.compare=function(that){return Object.compare(this.key,that.key)}},{"./listen/map-changes":8,"./listen/property-changes":9,"./shim-object":14}],5:[function(require,module,exports){var Object=require("./shim-object");module.exports=GenericOrder;function GenericOrder(){throw new Error("Can't construct. GenericOrder is a mixin.")}GenericOrder.prototype.equals=function(that,equals){equals=equals||this.contentEquals||Object.equals;if(this===that){return true}if(!that){return false}var self=this;return this.length===that.length&&this.zip(that).every(function(pair){return equals(pair[0],pair[1])})};GenericOrder.prototype.compare=function(that,compare){compare=compare||this.contentCompare||Object.compare;if(this===that){return 0}if(!that){return 1}var length=Math.min(this.length,that.length);var comparison=this.zip(that).reduce(function(comparison,pair,index){if(comparison===0){if(index>=length){return comparison}else{return compare(pair[0],pair[1])}}else{return comparison}},0);if(comparison===0){return this.length-that.length}return comparison};GenericOrder.prototype.toJSON=function(){return this.toArray()}},{"./shim-object":14}],6:[function(require,module,exports){module.exports=GenericSet;function GenericSet(){throw new Error("Can't construct. GenericSet is a mixin.")}GenericSet.prototype.isSet=true;GenericSet.prototype.union=function(that){var union=this.constructClone(this);union.addEach(that);return union};GenericSet.prototype.intersection=function(that){return this.constructClone(this.filter(function(value){return that.has(value)}))};GenericSet.prototype.difference=function(that){var union=this.constructClone(this);union.deleteEach(that);return union};GenericSet.prototype.symmetricDifference=function(that){var union=this.union(that);var intersection=this.intersection(that);return union.difference(intersection)};GenericSet.prototype.deleteAll=function(value){return+this["delete"](value)};GenericSet.prototype.equals=function(that,equals){var self=this;return that&&typeof that.reduce==="function"&&this.length===that.length&&that.reduce(function(equal,value){return equal&&self.has(value,equals)},true)};GenericSet.prototype.toJSON=function(){return this.toArray()};GenericSet.prototype.contains=function(value){return this.has(value)};GenericSet.prototype.remove=function(value){return this["delete"](value)};GenericSet.prototype.toggle=function(value){if(this.has(value)){this["delete"](value)}else{this.add(value)}}},{}],7:[function(require,module,exports){"use strict";module.exports=List;var Shim=require("./shim");var GenericCollection=require("./generic-collection");var GenericOrder=require("./generic-order");var PropertyChanges=require("./listen/property-changes");var RangeChanges=require("./listen/range-changes");function List(values,equals,getDefault){if(!(this instanceof List)){return new List(values,equals,getDefault)}var head=this.head=new this.Node;head.next=head;head.prev=head;this.contentEquals=equals||Object.equals;this.getDefault=getDefault||Function.noop;this.length=0;this.addEach(values)}List.List=List;Object.addEach(List.prototype,GenericCollection.prototype);Object.addEach(List.prototype,GenericOrder.prototype);Object.addEach(List.prototype,PropertyChanges.prototype);Object.addEach(List.prototype,RangeChanges.prototype);List.prototype.constructClone=function(values){return new this.constructor(values,this.contentEquals,this.getDefault)};List.prototype.find=function(value,equals,index){equals=equals||this.contentEquals;var head=this.head;var at=this.scan(index,head.next);while(at!==head){if(equals(at.value,value)){return at}at=at.next}};List.prototype.findLast=function(value,equals,index){equals=equals||this.contentEquals;var head=this.head;var at=this.scan(index,head.prev);while(at!==head){if(equals(at.value,value)){return at}at=at.prev}};List.prototype.has=function(value,equals){return!!this.find(value,equals)};List.prototype.get=function(value,equals){var found=this.find(value,equals);if(found){return found.value}return this.getDefault(value)};List.prototype["delete"]=function(value,equals){var found=this.findLast(value,equals);if(found){if(this.dispatchesRangeChanges){var plus=[];var minus=[value];this.dispatchBeforeRangeChange(plus,minus,found.index)}found["delete"]();this.length--;if(this.dispatchesRangeChanges){this.updateIndexes(found.next,found.index);this.dispatchRangeChange(plus,minus,found.index)}return true}return false};List.prototype.deleteAll=function(value,equals){equals=equals||this.contentEquals;var head=this.head;var at=head.next;var count=0;while(at!==head){if(equals(value,at.value)){at["delete"]();count++}at=at.next}this.length-=count;return count};List.prototype.clear=function(){var plus,minus;if(this.dispatchesRangeChanges){minus=this.toArray();plus=[];this.dispatchBeforeRangeChange(plus,minus,0)}this.head.next=this.head.prev=this.head;this.length=0;if(this.dispatchesRangeChanges){this.dispatchRangeChange(plus,minus,0)}};List.prototype.add=function(value){var node=new this.Node(value);if(this.dispatchesRangeChanges){node.index=this.length;this.dispatchBeforeRangeChange([value],[],node.index)}this.head.addBefore(node);this.length++;if(this.dispatchesRangeChanges){this.dispatchRangeChange([value],[],node.index)}return true};List.prototype.push=function(){var head=this.head;if(this.dispatchesRangeChanges){var plus=Array.prototype.slice.call(arguments);var minus=[];var index=this.length;this.dispatchBeforeRangeChange(plus,minus,index);var start=this.head.prev}for(var i=0;i<arguments.length;i++){var value=arguments[i];var node=new this.Node(value);head.addBefore(node)}this.length+=arguments.length;if(this.dispatchesRangeChanges){this.updateIndexes(start.next,start.index===undefined?0:start.index+1);this.dispatchRangeChange(plus,minus,index)}};List.prototype.unshift=function(){if(this.dispatchesRangeChanges){var plus=Array.prototype.slice.call(arguments);var minus=[];this.dispatchBeforeRangeChange(plus,minus,0)}var at=this.head;for(var i=0;i<arguments.length;i++){var value=arguments[i];var node=new this.Node(value);at.addAfter(node);at=node}this.length+=arguments.length;if(this.dispatchesRangeChanges){this.updateIndexes(this.head.next,0);this.dispatchRangeChange(plus,minus,0)}};List.prototype.pop=function(){var value;var head=this.head;if(head.prev!==head){value=head.prev.value;if(this.dispatchesRangeChanges){var plus=[];var minus=[value];var index=this.length-1;this.dispatchBeforeRangeChange(plus,minus,index)}head.prev["delete"]();this.length--;if(this.dispatchesRangeChanges){this.dispatchRangeChange(plus,minus,index)}}return value};List.prototype.shift=function(){var value;var head=this.head;if(head.prev!==head){value=head.next.value;if(this.dispatchesRangeChanges){var plus=[];var minus=[value];this.dispatchBeforeRangeChange(plus,minus,0)}head.next["delete"]();this.length--;if(this.dispatchesRangeChanges){this.updateIndexes(this.head.next,0);this.dispatchRangeChange(plus,minus,0)}}return value};List.prototype.peek=function(){if(this.head!==this.head.next){return this.head.next.value}};List.prototype.poke=function(value){if(this.head!==this.head.next){this.head.next.value=value}else{this.push(value)}};List.prototype.one=function(){return this.peek()};List.prototype.scan=function(at,fallback){var head=this.head;if(typeof at==="number"){var count=at;if(count>=0){at=head.next;while(count){count--;at=at.next;if(at==head){break}}}else{at=head;while(count<0){count++;at=at.prev;if(at==head){break}}}return at}else{return at||fallback}};List.prototype.slice=function(at,end){var sliced=[];var head=this.head;at=this.scan(at,head.next);end=this.scan(end,head);while(at!==end&&at!==head){sliced.push(at.value);at=at.next}return sliced};List.prototype.splice=function(at,length){return this.swap(at,length,Array.prototype.slice.call(arguments,2))};List.prototype.swap=function(start,length,plus){var initial=start;start=this.scan(start,this.head);if(length==null){length=Infinity}plus=Array.from(plus);var minus=[];var at=start;while(length--&&length>=0&&at!==this.head){minus.push(at.value);at=at.next}var index,startNode;if(this.dispatchesRangeChanges){if(start===this.head){index=this.length}else if(start.prev===this.head){index=0}else{index=start.index}startNode=start.prev;this.dispatchBeforeRangeChange(plus,minus,index)}var at=start;for(var i=0,at=start;i<minus.length;i++,at=at.next){at["delete"]()}if(initial==null&&at===this.head){at=this.head.next}for(var i=0;i<plus.length;i++){var node=new this.Node(plus[i]);at.addBefore(node)}this.length+=plus.length-minus.length;if(this.dispatchesRangeChanges){if(start===this.head){this.updateIndexes(this.head.next,0)}else{this.updateIndexes(startNode.next,startNode.index+1)}this.dispatchRangeChange(plus,minus,index)}return minus};List.prototype.reverse=function(){if(this.dispatchesRangeChanges){var minus=this.toArray();var plus=minus.reversed();this.dispatchBeforeRangeChange(plus,minus,0)}var at=this.head;do{var temp=at.next;at.next=at.prev;at.prev=temp;at=at.next}while(at!==this.head);if(this.dispatchesRangeChanges){this.dispatchRangeChange(plus,minus,0)}return this};List.prototype.sort=function(){this.swap(0,this.length,this.sorted())};List.prototype.reduce=function(callback,basis){var thisp=arguments[2];var head=this.head;var at=head.next;while(at!==head){basis=callback.call(thisp,basis,at.value,at,this);at=at.next}return basis};List.prototype.reduceRight=function(callback,basis){var thisp=arguments[2];var head=this.head;var at=head.prev;while(at!==head){basis=callback.call(thisp,basis,at.value,at,this);at=at.prev}return basis};List.prototype.updateIndexes=function(node,index){while(node!==this.head){node.index=index++;node=node.next}};List.prototype.makeObservable=function(){this.head.index=-1;this.updateIndexes(this.head.next,0);this.dispatchesRangeChanges=true};List.prototype.iterate=function(){return new ListIterator(this.head)};function ListIterator(head){this.head=head;this.at=head.next}ListIterator.prototype.next=function(){if(this.at===this.head){throw StopIteration}else{var value=this.at.value;this.at=this.at.next;return value}};List.prototype.Node=Node;function Node(value){this.value=value;this.prev=null;this.next=null}Node.prototype["delete"]=function(){this.prev.next=this.next;this.next.prev=this.prev};Node.prototype.addBefore=function(node){var prev=this.prev;this.prev=node;node.prev=prev;prev.next=node;node.next=this};Node.prototype.addAfter=function(node){var next=this.next;this.next=node;node.next=next;next.prev=node;node.prev=this}},{"./generic-collection":3,"./generic-order":5,"./listen/property-changes":9,"./listen/range-changes":10,"./shim":16}],8:[function(require,module,exports){"use strict";var WeakMap=require("weak-map");var List=require("../list");module.exports=MapChanges;function MapChanges(){throw new Error("Can't construct. MapChanges is a mixin.")}var object_owns=Object.prototype.hasOwnProperty;var mapChangeDescriptors=new WeakMap;MapChanges.prototype.getAllMapChangeDescriptors=function(){var Dict=require("../dict");if(!mapChangeDescriptors.has(this)){mapChangeDescriptors.set(this,Dict())}return mapChangeDescriptors.get(this)};MapChanges.prototype.getMapChangeDescriptor=function(token){var tokenChangeDescriptors=this.getAllMapChangeDescriptors();token=token||"";if(!tokenChangeDescriptors.has(token)){tokenChangeDescriptors.set(token,{willChangeListeners:new List,changeListeners:new List})}return tokenChangeDescriptors.get(token)};MapChanges.prototype.addMapChangeListener=function(listener,token,beforeChange){if(!this.isObservable&&this.makeObservable){this.makeObservable()}var descriptor=this.getMapChangeDescriptor(token);var listeners;if(beforeChange){listeners=descriptor.willChangeListeners}else{listeners=descriptor.changeListeners}listeners.push(listener);Object.defineProperty(this,"dispatchesMapChanges",{value:true,writable:true,configurable:true,enumerable:false});var self=this;return function cancelMapChangeListener(){if(!self){return}self.removeMapChangeListener(listener,token,beforeChange);self=null}};MapChanges.prototype.removeMapChangeListener=function(listener,token,beforeChange){var descriptor=this.getMapChangeDescriptor(token);var listeners;if(beforeChange){listeners=descriptor.willChangeListeners}else{listeners=descriptor.changeListeners}var node=listeners.findLast(listener);if(!node){throw new Error("Can't remove map change listener: does not exist: token "+JSON.stringify(token))}node["delete"]()};MapChanges.prototype.dispatchMapChange=function(key,value,beforeChange){var descriptors=this.getAllMapChangeDescriptors();var changeName="Map"+(beforeChange?"WillChange":"Change");descriptors.forEach(function(descriptor,token){if(descriptor.isActive){return}else{descriptor.isActive=true}var listeners;if(beforeChange){listeners=descriptor.willChangeListeners}else{listeners=descriptor.changeListeners}var tokenName="handle"+(token.slice(0,1).toUpperCase()+token.slice(1))+changeName;try{listeners.forEach(function(listener){if(listener[tokenName]){listener[tokenName](value,key,this)}else if(listener.call){listener.call(listener,value,key,this)}else{throw new Error("Handler "+listener+" has no method "+tokenName+" and is not callable")}},this)}finally{descriptor.isActive=false}},this)};MapChanges.prototype.addBeforeMapChangeListener=function(listener,token){return this.addMapChangeListener(listener,token,true)};MapChanges.prototype.removeBeforeMapChangeListener=function(listener,token){return this.removeMapChangeListener(listener,token,true)};MapChanges.prototype.dispatchBeforeMapChange=function(key,value){return this.dispatchMapChange(key,value,true)}},{"../dict":2,"../list":7,"weak-map":11}],9:[function(require,module,exports){require("../shim");var object_owns=Object.prototype.hasOwnProperty;module.exports=PropertyChanges;function PropertyChanges(){throw new Error("This is an abstract interface. Mix it. Don't construct it")}PropertyChanges.debug=true;PropertyChanges.prototype.getOwnPropertyChangeDescriptor=function(key){if(!this.__propertyChangeListeners__){Object.defineProperty(this,"__propertyChangeListeners__",{value:{},enumerable:false,configurable:true,writable:true})}var objectPropertyChangeDescriptors=this.__propertyChangeListeners__;if(!object_owns.call(objectPropertyChangeDescriptors,key)){var propertyName=String(key);propertyName=propertyName&&propertyName[0].toUpperCase()+propertyName.slice(1);objectPropertyChangeDescriptors[key]={willChangeListeners:{current:[],active:[],specificHandlerMethodName:"handle"+propertyName+"WillChange",genericHandlerMethodName:"handlePropertyWillChange"},changeListeners:{current:[],active:[],specificHandlerMethodName:"handle"+propertyName+"Change",genericHandlerMethodName:"handlePropertyChange"}}}return objectPropertyChangeDescriptors[key]};PropertyChanges.prototype.hasOwnPropertyChangeDescriptor=function(key){if(!this.__propertyChangeListeners__){return false}if(!key){return true}var objectPropertyChangeDescriptors=this.__propertyChangeListeners__;if(!object_owns.call(objectPropertyChangeDescriptors,key)){return false}return true};PropertyChanges.prototype.addOwnPropertyChangeListener=function(key,listener,beforeChange){if(this.makeObservable&&!this.isObservable){this.makeObservable()}var descriptor=PropertyChanges.getOwnPropertyChangeDescriptor(this,key);var listeners;if(beforeChange){listeners=descriptor.willChangeListeners}else{listeners=descriptor.changeListeners}PropertyChanges.makePropertyObservable(this,key);listeners.current.push(listener);var self=this;return function cancelOwnPropertyChangeListener(){PropertyChanges.removeOwnPropertyChangeListener(self,key,listener,beforeChange);self=null}};PropertyChanges.prototype.addBeforeOwnPropertyChangeListener=function(key,listener){return PropertyChanges.addOwnPropertyChangeListener(this,key,listener,true)};PropertyChanges.prototype.removeOwnPropertyChangeListener=function(key,listener,beforeChange){var descriptor=PropertyChanges.getOwnPropertyChangeDescriptor(this,key);var listeners;if(beforeChange){listeners=descriptor.willChangeListeners}else{listeners=descriptor.changeListeners}var index=listeners.current.lastIndexOf(listener);if(index===-1){throw new Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(key))}listeners.current.splice(index,1)};PropertyChanges.prototype.removeBeforeOwnPropertyChangeListener=function(key,listener){return PropertyChanges.removeOwnPropertyChangeListener(this,key,listener,true)};PropertyChanges.prototype.dispatchOwnPropertyChange=function(key,value,beforeChange){var descriptor=PropertyChanges.getOwnPropertyChangeDescriptor(this,key);if(descriptor.isActive){return}descriptor.isActive=true;var listeners;if(beforeChange){listeners=descriptor.willChangeListeners}else{listeners=descriptor.changeListeners}try{dispatchEach.call(this,listeners,key,value)}finally{descriptor.isActive=false}};function dispatchEach(listeners,key,value){var active=listeners.active;var current=listeners.current;var index=active.length=current.length;while(index--){active[index]=current[index]}for(var index=0,length=active.length;index<length;index++){var listener=active[index];if(current.indexOf(listener)<0){return}var thisp=listener;listener=listener[listeners.specificHandlerMethodName]||listener[listeners.genericHandlerMethodName]||listener;if(!listener.call){throw new Error("No event listener for "+listeners.specificHandlerName+" or "+listeners.genericHandlerName+" or call on "+listener)}listener.call(thisp,value,key,this)}}PropertyChanges.prototype.dispatchBeforeOwnPropertyChange=function(key,listener){return PropertyChanges.dispatchOwnPropertyChange(this,key,listener,true)};PropertyChanges.prototype.makePropertyObservable=function(key){if(Array.isArray(this)){return}if(!Object.isExtensible(this,key)){throw new Error("Can't make property "+JSON.stringify(key)+" observable on "+this+" because object is not extensible")}var state;if(typeof this.__state__==="object"){state=this.__state__}else{state={};if(Object.isExtensible(this,"__state__")){Object.defineProperty(this,"__state__",{value:state,writable:true,enumerable:false})}}state[key]=this[key];if(!this.__overriddenPropertyDescriptors__){overriddenPropertyDescriptors={};Object.defineProperty(this,"__overriddenPropertyDescriptors__",{value:{},enumerable:false,writable:true,configurable:true})}var overriddenPropertyDescriptors=this.__overriddenPropertyDescriptors__;if(object_owns.call(overriddenPropertyDescriptors,key)){return}var overriddenDescriptor;var attached=this;var formerDescriptor=Object.getOwnPropertyDescriptor(attached,key);do{overriddenDescriptor=Object.getOwnPropertyDescriptor(attached,key);if(overriddenDescriptor){break}attached=Object.getPrototypeOf(attached)}while(attached);overriddenDescriptor=overriddenDescriptor||{value:undefined,enumerable:true,writable:true,configurable:true};if(!overriddenDescriptor.configurable){return}overriddenPropertyDescriptors[key]=overriddenDescriptor;if(!overriddenDescriptor.writable&&!overriddenDescriptor.set){return}var propertyListener;if("value"in overriddenDescriptor){propertyListener={get:function(){return overriddenDescriptor.value},set:function(value){if(value===overriddenDescriptor.value){return value}PropertyChanges.dispatchBeforeOwnPropertyChange(this,key,overriddenDescriptor.value);        overriddenDescriptor.value=value;state[key]=value;PropertyChanges.dispatchOwnPropertyChange(this,key,value);return value},enumerable:overriddenDescriptor.enumerable,configurable:true}}else{propertyListener={get:function(){if(overriddenDescriptor.get){return overriddenDescriptor.get.apply(this,arguments)}},set:function(value){var formerValue;if(overriddenDescriptor.get){formerValue=overriddenDescriptor.get.apply(this,arguments)}if(overriddenDescriptor.set){overriddenDescriptor.set.apply(this,arguments)}if(overriddenDescriptor.get){value=overriddenDescriptor.get.apply(this,arguments);state[key]=value}if(value===formerValue){return value}PropertyChanges.dispatchBeforeOwnPropertyChange(this,key,formerValue);PropertyChanges.dispatchOwnPropertyChange(this,key,value);return value},enumerable:overriddenDescriptor.enumerable,configurable:true}}Object.defineProperty(this,key,propertyListener)};PropertyChanges.getOwnPropertyChangeDescriptor=function(object,key){if(object.getOwnPropertyChangeDescriptor){return object.getOwnPropertyChangeDescriptor(key)}else{return PropertyChanges.prototype.getOwnPropertyChangeDescriptor.call(object,key)}};PropertyChanges.hasOwnPropertyChangeDescriptor=function(object,key){if(object.hasOwnPropertyChangeDescriptor){return object.hasOwnPropertyChangeDescriptor(key)}else{return PropertyChanges.prototype.hasOwnPropertyChangeDescriptor.call(object,key)}};PropertyChanges.addOwnPropertyChangeListener=function(object,key,listener,beforeChange){if(!Object.isObject(object)){}else if(object.addOwnPropertyChangeListener){return object.addOwnPropertyChangeListener(key,listener,beforeChange)}else{return PropertyChanges.prototype.addOwnPropertyChangeListener.call(object,key,listener,beforeChange)}};PropertyChanges.removeOwnPropertyChangeListener=function(object,key,listener,beforeChange){if(!Object.isObject(object)){}else if(object.removeOwnPropertyChangeListener){return object.removeOwnPropertyChangeListener(key,listener,beforeChange)}else{return PropertyChanges.prototype.removeOwnPropertyChangeListener.call(object,key,listener,beforeChange)}};PropertyChanges.dispatchOwnPropertyChange=function(object,key,value,beforeChange){if(!Object.isObject(object)){}else if(object.dispatchOwnPropertyChange){return object.dispatchOwnPropertyChange(key,value,beforeChange)}else{return PropertyChanges.prototype.dispatchOwnPropertyChange.call(object,key,value,beforeChange)}};PropertyChanges.addBeforeOwnPropertyChangeListener=function(object,key,listener){return PropertyChanges.addOwnPropertyChangeListener(object,key,listener,true)};PropertyChanges.removeBeforeOwnPropertyChangeListener=function(object,key,listener){return PropertyChanges.removeOwnPropertyChangeListener(object,key,listener,true)};PropertyChanges.dispatchBeforeOwnPropertyChange=function(object,key,value){return PropertyChanges.dispatchOwnPropertyChange(object,key,value,true)};PropertyChanges.makePropertyObservable=function(object,key){if(object.makePropertyObservable){return object.makePropertyObservable(key)}else{return PropertyChanges.prototype.makePropertyObservable.call(object,key)}}},{"../shim":16}],10:[function(require,module,exports){"use strict";var WeakMap=require("weak-map");var Dict=require("../dict");var rangeChangeDescriptors=new WeakMap;module.exports=RangeChanges;function RangeChanges(){throw new Error("Can't construct. RangeChanges is a mixin.")}RangeChanges.prototype.getAllRangeChangeDescriptors=function(){if(!rangeChangeDescriptors.has(this)){rangeChangeDescriptors.set(this,Dict())}return rangeChangeDescriptors.get(this)};RangeChanges.prototype.getRangeChangeDescriptor=function(token){var tokenChangeDescriptors=this.getAllRangeChangeDescriptors();token=token||"";if(!tokenChangeDescriptors.has(token)){tokenChangeDescriptors.set(token,{isActive:false,changeListeners:[],willChangeListeners:[]})}return tokenChangeDescriptors.get(token)};RangeChanges.prototype.addRangeChangeListener=function(listener,token,beforeChange){if(!this.isObservable&&this.makeObservable){this.makeObservable()}var descriptor=this.getRangeChangeDescriptor(token);var listeners;if(beforeChange){listeners=descriptor.willChangeListeners}else{listeners=descriptor.changeListeners}listeners.push(listener);Object.defineProperty(this,"dispatchesRangeChanges",{value:true,writable:true,configurable:true,enumerable:false});var self=this;return function cancelRangeChangeListener(){if(!self){return}self.removeRangeChangeListener(listener,token,beforeChange);self=null}};RangeChanges.prototype.removeRangeChangeListener=function(listener,token,beforeChange){var descriptor=this.getRangeChangeDescriptor(token);var listeners;if(beforeChange){listeners=descriptor.willChangeListeners}else{listeners=descriptor.changeListeners}var index=listeners.lastIndexOf(listener);if(index===-1){throw new Error("Can't remove range change listener: does not exist: token "+JSON.stringify(token))}listeners.splice(index,1)};RangeChanges.prototype.dispatchRangeChange=function(plus,minus,index,beforeChange){var descriptors=this.getAllRangeChangeDescriptors();var changeName="Range"+(beforeChange?"WillChange":"Change");descriptors.forEach(function(descriptor,token){if(descriptor.isActive){return}else{descriptor.isActive=true}var listeners;if(beforeChange){listeners=descriptor.willChangeListeners}else{listeners=descriptor.changeListeners}var tokenName="handle"+(token.slice(0,1).toUpperCase()+token.slice(1))+changeName;try{listeners.slice().forEach(function(listener){if(listeners.indexOf(listener)<0){return}if(listener[tokenName]){listener[tokenName](plus,minus,index,this,beforeChange)}else if(listener.call){listener.call(this,plus,minus,index,this,beforeChange)}else{throw new Error("Handler "+listener+" has no method "+tokenName+" and is not callable")}},this)}finally{descriptor.isActive=false}},this)};RangeChanges.prototype.addBeforeRangeChangeListener=function(listener,token){return this.addRangeChangeListener(listener,token,true)};RangeChanges.prototype.removeBeforeRangeChangeListener=function(listener,token){return this.removeRangeChangeListener(listener,token,true)};RangeChanges.prototype.dispatchBeforeRangeChange=function(plus,minus,index){return this.dispatchRangeChange(plus,minus,index,true)}},{"../dict":2,"weak-map":11}],11:[function(require,module,exports){(function WeakMapModule(){"use strict";if(typeof ses!=="undefined"&&ses.ok&&!ses.ok()){return}function weakMapPermitHostObjects(map){if(map.permitHostObjects___){map.permitHostObjects___(weakMapPermitHostObjects)}}if(typeof ses!=="undefined"){ses.weakMapPermitHostObjects=weakMapPermitHostObjects}if(typeof WeakMap==="function"){var HostWeakMap=WeakMap;if(typeof navigator!=="undefined"&&/Firefox/.test(navigator.userAgent)){}else{module.exports=WeakMap;return}}var hop=Object.prototype.hasOwnProperty;var gopn=Object.getOwnPropertyNames;var defProp=Object.defineProperty;var isExtensible=Object.isExtensible;var HIDDEN_NAME_PREFIX="weakmap:";var HIDDEN_NAME=HIDDEN_NAME_PREFIX+"ident:"+Math.random()+"___";if(typeof crypto!=="undefined"&&typeof crypto.getRandomValues==="function"&&typeof ArrayBuffer==="function"&&typeof Uint8Array==="function"){var ab=new ArrayBuffer(25);var u8s=new Uint8Array(ab);crypto.getRandomValues(u8s);HIDDEN_NAME=HIDDEN_NAME_PREFIX+"rand:"+Array.prototype.map.call(u8s,function(u8){return(u8%36).toString(36)}).join("")+"___"}function isNotHiddenName(name){return!(name.substr(0,HIDDEN_NAME_PREFIX.length)==HIDDEN_NAME_PREFIX&&name.substr(name.length-3)==="___")}defProp(Object,"getOwnPropertyNames",{value:function fakeGetOwnPropertyNames(obj){return gopn(obj).filter(isNotHiddenName)}});if("getPropertyNames"in Object){var originalGetPropertyNames=Object.getPropertyNames;defProp(Object,"getPropertyNames",{value:function fakeGetPropertyNames(obj){return originalGetPropertyNames(obj).filter(isNotHiddenName)}})}function getHiddenRecord(key){if(key!==Object(key)){throw new TypeError("Not an object: "+key)}var hiddenRecord=key[HIDDEN_NAME];if(hiddenRecord&&hiddenRecord.key===key){return hiddenRecord}if(!isExtensible(key)){return void 0}var gets=[];var vals=[];hiddenRecord={key:key,gets:gets,vals:vals};defProp(key,HIDDEN_NAME,{value:hiddenRecord,writable:false,enumerable:false,configurable:false});return hiddenRecord}(function(){var oldFreeze=Object.freeze;defProp(Object,"freeze",{value:function identifyingFreeze(obj){getHiddenRecord(obj);return oldFreeze(obj)}});var oldSeal=Object.seal;defProp(Object,"seal",{value:function identifyingSeal(obj){getHiddenRecord(obj);return oldSeal(obj)}});var oldPreventExtensions=Object.preventExtensions;defProp(Object,"preventExtensions",{value:function identifyingPreventExtensions(obj){getHiddenRecord(obj);return oldPreventExtensions(obj)}})})();function constFunc(func){func.prototype=null;return Object.freeze(func)}var OurWeakMap=function(){var keys=[];var vals=[];function get___(key,opt_default){var hr=getHiddenRecord(key);var i,vs;if(hr){i=hr.gets.indexOf(get___);vs=hr.vals}else{i=keys.indexOf(key);vs=vals}return i>=0?vs[i]:opt_default}function has___(key){var hr=getHiddenRecord(key);var i;if(hr){i=hr.gets.indexOf(get___)}else{i=keys.indexOf(key)}return i>=0}function set___(key,value){var hr=getHiddenRecord(key);var i;if(hr){i=hr.gets.indexOf(get___);if(i>=0){hr.vals[i]=value}else{hr.gets.push(get___);hr.vals.push(value)}}else{i=keys.indexOf(key);if(i>=0){vals[i]=value}else{keys.push(key);vals.push(value)}}}function delete___(key){var hr=getHiddenRecord(key);var i;if(hr){i=hr.gets.indexOf(get___);if(i>=0){hr.gets.splice(i,1);hr.vals.splice(i,1)}}else{i=keys.indexOf(key);if(i>=0){keys.splice(i,1);vals.splice(i,1)}}return true}return Object.create(OurWeakMap.prototype,{get___:{value:constFunc(get___)},has___:{value:constFunc(has___)},set___:{value:constFunc(set___)},delete___:{value:constFunc(delete___)}})};OurWeakMap.prototype=Object.create(Object.prototype,{get:{value:function get(key,opt_default){return this.get___(key,opt_default)},writable:true,configurable:true},has:{value:function has(key){return this.has___(key)},writable:true,configurable:true},set:{value:function set(key,value){this.set___(key,value)},writable:true,configurable:true},"delete":{value:function remove(key){return this.delete___(key)},writable:true,configurable:true}});if(typeof HostWeakMap==="function"){(function(){function DoubleWeakMap(){var hmap=new HostWeakMap;var omap=undefined;var enableSwitching=false;function dget(key,opt_default){if(omap){return hmap.has(key)?hmap.get(key):omap.get___(key,opt_default)}else{return hmap.get(key,opt_default)}}function dhas(key){return hmap.has(key)||(omap?omap.has___(key):false)}function dset(key,value){if(enableSwitching){try{hmap.set(key,value)}catch(e){if(!omap){omap=new OurWeakMap}omap.set___(key,value)}}else{hmap.set(key,value)}}function ddelete(key){hmap["delete"](key);if(omap){omap.delete___(key)}}return Object.create(OurWeakMap.prototype,{get___:{value:constFunc(dget)},has___:{value:constFunc(dhas)},set___:{value:constFunc(dset)},delete___:{value:constFunc(ddelete)},permitHostObjects___:{value:constFunc(function(token){if(token===weakMapPermitHostObjects){enableSwitching=true}else{throw new Error("bogus call to permitHostObjects___")}})}})}DoubleWeakMap.prototype=OurWeakMap.prototype;module.exports=DoubleWeakMap;Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:false,configurable:true,writable:true})})()}else{if(typeof Proxy!=="undefined"){Proxy=undefined}module.exports=OurWeakMap}})()},{}],12:[function(require,module,exports){"use strict";var Function=require("./shim-function");var GenericCollection=require("./generic-collection");var GenericOrder=require("./generic-order");var WeakMap=require("weak-map");module.exports=Array;var array_splice=Array.prototype.splice;var array_slice=Array.prototype.slice;Array.empty=[];if(Object.freeze){Object.freeze(Array.empty)}Array.from=function(values){var array=[];array.addEach(values);return array};Array.unzip=function(table){var transpose=[];var length=Infinity;for(var i=0;i<table.length;i++){var row=table[i];table[i]=row.toArray();if(row.length<length){length=row.length}}for(var i=0;i<table.length;i++){var row=table[i];for(var j=0;j<row.length;j++){if(j<length&&j in row){transpose[j]=transpose[j]||[];transpose[j][i]=row[j]}}}return transpose};function define(key,value){Object.defineProperty(Array.prototype,key,{value:value,writable:true,configurable:true,enumerable:false})}define("addEach",GenericCollection.prototype.addEach);define("deleteEach",GenericCollection.prototype.deleteEach);define("toArray",GenericCollection.prototype.toArray);define("toObject",GenericCollection.prototype.toObject);define("all",GenericCollection.prototype.all);define("any",GenericCollection.prototype.any);define("min",GenericCollection.prototype.min);define("max",GenericCollection.prototype.max);define("sum",GenericCollection.prototype.sum);define("average",GenericCollection.prototype.average);define("only",GenericCollection.prototype.only);define("flatten",GenericCollection.prototype.flatten);define("zip",GenericCollection.prototype.zip);define("enumerate",GenericCollection.prototype.enumerate);define("group",GenericCollection.prototype.group);define("sorted",GenericCollection.prototype.sorted);define("reversed",GenericCollection.prototype.reversed);define("constructClone",function(values){var clone=new this.constructor;clone.addEach(values);return clone});define("has",function(value,equals){return this.find(value,equals)!==-1});define("get",function(index,defaultValue){if(+index!==index)throw new Error("Indicies must be numbers");if(!index in this){return defaultValue}else{return this[index]}});define("set",function(index,value){this[index]=value;return true});define("add",function(value){this.push(value);return true});define("delete",function(value,equals){var index=this.find(value,equals);if(index!==-1){this.splice(index,1);return true}return false});define("deleteAll",function(value,equals){equals=equals||this.contentEquals||Object.equals;var count=0;for(var index=0;index<this.length;){if(equals(value,this[index])){this.swap(index,1);count++}else{index++}}return count});define("find",function(value,equals){equals=equals||this.contentEquals||Object.equals;for(var index=0;index<this.length;index++){if(index in this&&equals(value,this[index])){return index}}return-1});define("findLast",function(value,equals){equals=equals||this.contentEquals||Object.equals;var index=this.length;do{index--;if(index in this&&equals(this[index],value)){return index}}while(index>0);return-1});define("swap",function(start,length,plus){var args,plusLength,i,j,returnValue;if(start>this.length){this.length=start}if(typeof plus!=="undefined"){args=[start,length];if(!Array.isArray(plus)){plus=array_slice.call(plus)}i=0;plusLength=plus.length;if(plusLength<1e3){for(i;i<plusLength;i++){args[i+2]=plus[i]}return array_splice.apply(this,args)}else{returnValue=array_splice.apply(this,args);for(i;i<plusLength;){args=[start+i,0];for(j=2;j<1002&&i<plusLength;j++,i++){args[j]=plus[i]}array_splice.apply(this,args)}return returnValue}}else if(typeof length!=="undefined"){return array_splice.call(this,start,length)}else if(typeof start!=="undefined"){return array_splice.call(this,start)}else{return[]}});define("peek",function(){return this[0]});define("poke",function(value){if(this.length>0){this[0]=value}});define("peekBack",function(){if(this.length>0){return this[this.length-1]}});define("pokeBack",function(value){if(this.length>0){this[this.length-1]=value}});define("one",function(){for(var i in this){if(Object.owns(this,i)){return this[i]}}});define("clear",function(){this.length=0;return this});define("compare",function(that,compare){compare=compare||Object.compare;var i;var length;var lhs;var rhs;var relative;if(this===that){return 0}if(!that||!Array.isArray(that)){return GenericOrder.prototype.compare.call(this,that,compare)}length=Math.min(this.length,that.length);for(i=0;i<length;i++){if(i in this){if(!(i in that)){return-1}else{lhs=this[i];rhs=that[i];relative=compare(lhs,rhs);if(relative){return relative}}}else if(i in that){return 1}}return this.length-that.length});define("equals",function(that,equals){equals=equals||Object.equals;var i=0;var length=this.length;var left;var right;if(this===that){return true}if(!that||!Array.isArray(that)){return GenericOrder.prototype.equals.call(this,that)}if(length!==that.length){return false}else{for(;i<length;++i){if(i in this){if(!(i in that)){return false}left=this[i];right=that[i];if(!equals(left,right)){return false}}else{if(i in that){return false}}}}return true});define("clone",function(depth,memo){if(depth==null){depth=Infinity}else if(depth===0){return this}memo=memo||new WeakMap;if(memo.has(this)){return memo.get(this)}var clone=new Array(this.length);memo.set(this,clone);for(var i in this){clone[i]=Object.clone(this[i],depth-1,memo)}return clone});define("iterate",function(start,end){return new ArrayIterator(this,start,end)});define("Iterator",ArrayIterator);function ArrayIterator(array,start,end){this.array=array;this.start=start==null?0:start;this.end=end}ArrayIterator.prototype.next=function(){if(this.start===(this.end==null?this.array.length:this.end)){throw StopIteration}else{return this.array[this.start++]}}},{"./generic-collection":3,"./generic-order":5,"./shim-function":13,"weak-map":11}],13:[function(require,module,exports){module.exports=Function;Function.noop=function(){};Function.identity=function(value){return value};Function.by=function(by,compare){compare=compare||Object.compare;by=by||Function.identity;var compareBy=function(a,b){return compare(by(a),by(b))};compareBy.compare=compare;compareBy.by=by;return compareBy};Function.get=function(key){return function(object){return Object.get(object,key)}}},{}],14:[function(require,module,exports){"use strict";var WeakMap=require("weak-map");module.exports=Object;Object.empty=Object.freeze(Object.create(null));Object.isObject=function(object){return Object(object)===object};Object.getValueOf=function(value){if(value&&typeof value.valueOf==="function"){value=value.valueOf()}return value};var hashMap=new WeakMap;Object.hash=function(object){if(object&&typeof object.hash==="function"){return""+object.hash()}else if(Object(object)===object){if(!hashMap.has(object)){hashMap.set(object,Math.random().toString(36).slice(2))}return hashMap.get(object)}else{return""+object}};var owns=Object.prototype.hasOwnProperty;Object.owns=function(object,key){return owns.call(object,key)};Object.has=function(object,key){if(typeof object!=="object"){throw new Error("Object.has can't accept non-object: "+typeof object)}if(object&&typeof object.has==="function"){return object.has(key)}else if(typeof key==="string"){return key in object&&object[key]!==Object.prototype[key]}else{throw new Error("Key must be a string for Object.has on plain objects")}};Object.get=function(object,key,value){if(typeof object!=="object"){throw new Error("Object.get can't accept non-object: "+typeof object)}if(object&&typeof object.get==="function"){return object.get(key,value)}else if(Object.has(object,key)){return object[key]}else{return value}};Object.set=function(object,key,value){if(object&&typeof object.set==="function"){object.set(key,value)}else{object[key]=value}};Object.addEach=function(target,source){if(!source){}else if(typeof source.forEach==="function"&&!source.hasOwnProperty("forEach")){if(source.isMap===true){source.forEach(function(value,key){target[key]=value})}else{source.forEach(function(pair){target[pair[0]]=pair[1]})}}else if(typeof source.length==="number"){for(var index=0;index<source.length;index++){target[index]=source[index]}}else{Object.keys(source).forEach(function(key){target[key]=source[key]})}return target};Object.forEach=function(object,callback,thisp){Object.keys(object).forEach(function(key){callback.call(thisp,object[key],key,object)})};Object.map=function(object,callback,thisp){return Object.keys(object).map(function(key){return callback.call(thisp,object[key],key,object)})};Object.values=function(object){return Object.map(object,Function.identity)};Object.concat=function(){var object={};for(var i=0;i<arguments.length;i++){Object.addEach(object,arguments[i])}return object};Object.from=Object.concat;Object.is=function(x,y){if(x===y){return x!==0||1/x===1/y}return x!==x&&y!==y};Object.equals=function(a,b,equals,memo){equals=equals||Object.equals;a=Object.getValueOf(a);b=Object.getValueOf(b);if(a===b)return true;if(Object.isObject(a)){memo=memo||new WeakMap;if(memo.has(a)){return true}memo.set(a,true)}if(Object.isObject(a)&&typeof a.equals==="function"){return a.equals(b,equals,memo)}if(Object.isObject(b)&&typeof b.equals==="function"){return b.equals(a,equals,memo)}if(Object.isObject(a)&&Object.isObject(b)){if(Object.getPrototypeOf(a)===Object.prototype&&Object.getPrototypeOf(b)===Object.prototype){for(var name in a){if(!equals(a[name],b[name],equals,memo)){return false}}for(var name in b){if(!(name in a)||!equals(b[name],a[name],equals,memo)){return false}}return true}}if(a!==a&&b!==b)return true;if(!a||!b)return a===b;return false};Object.compare=function(a,b){a=Object.getValueOf(a);b=Object.getValueOf(b);if(a===b)return 0;var aType=typeof a;var bType=typeof b;if(aType==="number"&&bType==="number")return a-b;if(aType==="string"&&bType==="string")return a<b?-Infinity:Infinity;if(a&&typeof a.compare==="function")return a.compare(b);if(b&&typeof b.compare==="function")return-b.compare(a);return 0};Object.clone=function(value,depth,memo){value=Object.getValueOf(value);memo=memo||new WeakMap;if(depth===undefined){depth=Infinity}else if(depth===0){return value}if(Object.isObject(value)){if(!memo.has(value)){if(value&&typeof value.clone==="function"){memo.set(value,value.clone(depth,memo))}else{var prototype=Object.getPrototypeOf(value);if(prototype===null||prototype===Object.prototype){var clone=Object.create(prototype);memo.set(value,clone);for(var key in value){clone[key]=Object.clone(value[key],depth-1,memo)}}else{throw new Error("Can't clone "+value)}}}return memo.get(value)}return value};Object.clear=function(object){if(object&&typeof object.clear==="function"){object.clear()}else{var keys=Object.keys(object),i=keys.length;while(i){i--;delete object[keys[i]]}}return object}},{"weak-map":11}],15:[function(require,module,exports){if(!RegExp.escape){var special=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(string){return string.replace(special,"\\$&")}}},{}],16:[function(require,module,exports){var Array=require("./shim-array");var Object=require("./shim-object");var Function=require("./shim-function");var RegExp=require("./shim-regexp")},{"./shim-array":12,"./shim-function":13,"./shim-object":14,"./shim-regexp":15}],17:[function(require,module,exports){"use strict";module.exports=SortedSet;var Shim=require("./shim");var GenericCollection=require("./generic-collection");var GenericSet=require("./generic-set");var PropertyChanges=require("./listen/property-changes");var RangeChanges=require("./listen/range-changes");var TreeLog=require("./tree-log");function SortedSet(values,equals,compare,getDefault){if(!(this instanceof SortedSet)){return new SortedSet(values,equals,compare,getDefault)}this.contentEquals=equals||Object.equals;this.contentCompare=compare||Object.compare;this.getDefault=getDefault||Function.noop;this.root=null;this.length=0;this.addEach(values)}SortedSet.SortedSet=SortedSet;Object.addEach(SortedSet.prototype,GenericCollection.prototype);Object.addEach(SortedSet.prototype,GenericSet.prototype);Object.addEach(SortedSet.prototype,PropertyChanges.prototype);Object.addEach(SortedSet.prototype,RangeChanges.prototype);SortedSet.prototype.isSorted=true;SortedSet.prototype.constructClone=function(values){return new this.constructor(values,this.contentEquals,this.contentCompare,this.getDefault)};SortedSet.prototype.has=function(value,equals){if(equals){throw new Error("SortedSet#has does not support second argument: equals")}if(this.root){this.splay(value);return this.contentEquals(value,this.root.value)}else{return false}};SortedSet.prototype.get=function(value,equals){if(equals){throw new Error("SortedSet#get does not support second argument: equals")}if(this.root){this.splay(value);if(this.contentEquals(value,this.root.value)){return this.root.value}}return this.getDefault(value)};SortedSet.prototype.add=function(value){var node=new this.Node(value);if(this.root){this.splay(value);if(!this.contentEquals(value,this.root.value)){var comparison=this.contentCompare(value,this.root.value);if(comparison===0){throw new Error("SortedSet cannot contain incomparable but inequal values: "+value+" and "+this.root.value)}if(this.dispatchesRangeChanges){this.dispatchBeforeRangeChange([value],[],this.root.index)}if(comparison<0){node.right=this.root;node.left=this.root.left;this.root.left=null;this.root.touch()}else{node.left=this.root;node.right=this.root.right;this.root.right=null;this.root.touch()}node.touch();this.root=node;this.length++;if(this.dispatchesRangeChanges){this.dispatchRangeChange([value],[],this.root.index)}return true}}else{if(this.dispatchesRangeChanges){this.dispatchBeforeRangeChange([value],[],0)}this.root=node;this.length++;if(this.dispatchesRangeChanges){this.dispatchRangeChange([value],[],0)}return true}return false};SortedSet.prototype["delete"]=function(value,equals){if(equals){throw new Error("SortedSet#delete does not support second argument: equals")}if(this.root){this.splay(value);if(this.contentEquals(value,this.root.value)){var index=this.root.index;if(this.dispatchesRangeChanges){this.dispatchBeforeRangeChange([],[value],index)}if(!this.root.left){this.root=this.root.right}else{var right=this.root.right;this.root=this.root.left;this.splay(value);this.root.right=right}this.length--;if(this.root){this.root.touch()}if(this.dispatchesRangeChanges){this.dispatchRangeChange([],[value],index)}return true}}return false};SortedSet.prototype.indexOf=function(value,index){if(index){throw new Error("SortedSet#indexOf does not support second argument: startIndex")}if(this.root){this.splay(value);if(this.contentEquals(value,this.root.value)){return this.root.index}}return-1};SortedSet.prototype.find=function(value,equals,index){if(equals){throw new Error("SortedSet#find does not support second argument: equals")}if(index){throw new Error("SortedSet#find does not support third argument: index")}if(this.root){this.splay(value);if(this.contentEquals(value,this.root.value)){return this.root}}};SortedSet.prototype.findGreatest=function(at){if(this.root){at=at||this.root;while(at.right){at=at.right}return at}};SortedSet.prototype.findLeast=function(at){if(this.root){at=at||this.root;while(at.left){at=at.left}return at}};SortedSet.prototype.findGreatestLessThanOrEqual=function(value){if(this.root){this.splay(value);if(this.contentCompare(this.root.value,value)>0){return this.root.getPrevious()}else{return this.root}}};SortedSet.prototype.findGreatestLessThan=function(value){if(this.root){this.splay(value);if(this.contentCompare(this.root.value,value)>=0){return this.root.getPrevious()}else{return this.root}}};SortedSet.prototype.findLeastGreaterThanOrEqual=function(value){if(this.root){this.splay(value);if(this.contentCompare(this.root.value,value)>=0){return this.root}else{return this.root.getNext()}}};SortedSet.prototype.findLeastGreaterThan=function(value){if(this.root){this.splay(value);if(this.contentCompare(this.root.value,value)<=0){return this.root.getNext()}else{return this.root}}};SortedSet.prototype.pop=function(){if(this.root){var found=this.findGreatest();this["delete"](found.value);return found.value}};SortedSet.prototype.shift=function(){if(this.root){var found=this.findLeast();this["delete"](found.value);return found.value}};SortedSet.prototype.push=function(){this.addEach(arguments)};SortedSet.prototype.unshift=function(){this.addEach(arguments)};SortedSet.prototype.slice=function(start,end){var temp;start=start||0;end=end||this.length;if(start<0){start+=this.length}if(end<0){end+=this.length}var sliced=[];if(this.root){this.splayIndex(start);while(this.root.index<end){sliced.push(this.root.value);if(!this.root.right){break}this.splay(this.root.getNext().value)}}return sliced};SortedSet.prototype.splice=function(at,length){return this.swap(at,length,Array.prototype.slice.call(arguments,2))};SortedSet.prototype.swap=function(start,length,plus){if(start===undefined&&length===undefined){return[]}start=start||0;if(start<0){start+=this.length}if(length===undefined){length=Infinity}var swapped=[];if(this.root){this.splayIndex(start);for(var i=0;i<length;i++){swapped.push(this.root.value);var next=this.root.getNext();this["delete"](this.root.value);if(!next){break}this.splay(next.value)}}this.addEach(plus);return swapped};SortedSet.prototype.splay=function(value){var stub,left,right,temp,root,history;if(!this.root){return}stub=left=right=new this.Node;history=new this.Node;root=this.root;while(true){var comparison=this.contentCompare(value,root.value);if(comparison<0){if(root.left){if(this.contentCompare(value,root.left.value)<0){temp=root.left;root.left=temp.right;root.touch();temp.right=root;temp.touch();root=temp;if(!root.left){break}}temp=new Node;temp.right=root;temp.left=history.left;history.left=temp;right.left=root;right.touch();right=root;root=root.left}else{break}}else if(comparison>0){if(root.right){if(this.contentCompare(value,root.right.value)>0){temp=root.right;root.right=temp.left;root.touch();temp.left=root;temp.touch();root=temp;if(!root.right){break}}temp=new Node;temp.left=root;temp.right=history.right;history.right=temp;left.right=root;left.touch();left=root;root=root.right}else{break}}else{break}}left.right=root.left;left.touch();right.left=root.right;right.touch();root.left=stub.right;root.right=stub.left;while(history.left){history.left.right.touch();history.left=history.left.left}while(history.right){history.right.left.touch();history.right=history.right.right}root.touch();this.root=root};SortedSet.prototype.splayIndex=function(index){if(this.root){var at=this.root;var atIndex=this.root.index;while(atIndex!==index){if(atIndex>index&&at.left){at=at.left;atIndex-=1+(at.right?at.right.length:0)}else if(atIndex<index&&at.right){at=at.right;atIndex+=1+(at.left?at.left.length:0)}else{break}}this.splay(at.value);return this.root.index===index}return false};SortedSet.prototype.reduce=function(callback,basis,thisp){if(this.root){basis=this.root.reduce(callback,basis,0,thisp,this)}return basis};SortedSet.prototype.reduceRight=function(callback,basis,thisp){if(this.root){basis=this.root.reduceRight(callback,basis,this.length-1,thisp,this)}return basis};SortedSet.prototype.min=function(at){var least=this.findLeast(at);if(least){return least.value}};SortedSet.prototype.max=function(at){var greatest=this.findGreatest(at);if(greatest){return greatest.value}};SortedSet.prototype.one=function(){return this.min()};SortedSet.prototype.clear=function(){var minus;if(this.dispatchesRangeChanges){minus=this.toArray();this.dispatchBeforeRangeChange([],minus,0)}this.root=null;this.length=0;if(this.dispatchesRangeChanges){this.dispatchRangeChange([],minus,0)}};SortedSet.prototype.iterate=function(start,end){return new this.Iterator(this,start,end)};SortedSet.prototype.Iterator=Iterator;SortedSet.prototype.summary=function(){if(this.root){return this.root.summary()}else{return"()"}};SortedSet.prototype.log=function(charmap,logNode,callback,thisp){charmap=charmap||TreeLog.unicodeRound;logNode=logNode||this.logNode;if(!callback){callback=console.log;thisp=console}callback=callback.bind(thisp);if(this.root){this.root.log(charmap,logNode,callback,callback)}};SortedSet.prototype.logNode=function(node,log,logBefore){log(" "+node.value)};SortedSet.logCharsets=TreeLog;SortedSet.prototype.Node=Node;function Node(value){this.value=value;this.left=null;this.right=null;this.length=1}Node.prototype.reduce=function(callback,basis,index,thisp,tree,depth){depth=depth||0;if(this.left){var length=this.left.length;basis=this.left.reduce(callback,basis,index,thisp,tree,depth+1);        index+=length}basis=callback.call(thisp,basis,this.value,index,tree,this,depth);index+=1;if(this.right){basis=this.right.reduce(callback,basis,index,thisp,tree,depth+1)}return basis};Node.prototype.reduceRight=function(callback,basis,index,thisp,tree,depth){depth=depth||0;if(this.right){basis=this.right.reduce(callback,basis,index,thisp,tree,depth+1);index-=this.right.length}basis=callback.call(thisp,basis,this.value,this.value,tree,this,depth);index-=1;if(this.left){basis=this.left.reduce(callback,basis,index,thisp,tree,depth+1)}return basis};Node.prototype.touch=function(){this.length=1+(this.left?this.left.length:0)+(this.right?this.right.length:0);this.index=this.left?this.left.length:0};Node.prototype.checkIntegrity=function(){var length=1;length+=this.left?this.left.checkIntegrity():0;length+=this.right?this.right.checkIntegrity():0;if(this.length!==length)throw new Error("Integrity check failed: "+this.summary());return length};Node.prototype.getNext=function(){var node=this;if(node.right){node=node.right;while(node.left){node=node.left}return node}};Node.prototype.getPrevious=function(){var node=this;if(node.left){node=node.left;while(node.right){node=node.right}return node}};Node.prototype.summary=function(){var value=this.value||"-";value+=" <"+this.length;if(!this.left&&!this.right){return"("+value+")"}return"("+value+" "+(this.left?this.left.summary():"()")+", "+(this.right?this.right.summary():"()")+")"};Node.prototype.log=function(charmap,logNode,log,logAbove){var self=this;var branch;if(this.left&&this.right){branch=charmap.intersection}else if(this.left){branch=charmap.branchUp}else if(this.right){branch=charmap.branchDown}else{branch=charmap.through}var loggedAbove;this.left&&this.left.log(charmap,logNode,function innerWrite(line){if(!loggedAbove){loggedAbove=true;logAbove(charmap.fromBelow+charmap.through+line)}else{logAbove(charmap.strafe+" "+line)}},function innerWriteAbove(line){logAbove("  "+line)});var loggedOn;logNode(this,function innerWrite(line){if(!loggedOn){loggedOn=true;log(branch+line)}else{log((self.right?charmap.strafe:" ")+line)}},function innerWriteAbove(line){logAbove((self.left?charmap.strafe:" ")+line)});var loggedBelow;this.right&&this.right.log(charmap,logNode,function innerWrite(line){if(!loggedBelow){loggedBelow=true;log(charmap.fromAbove+charmap.through+line)}else{log("  "+line)}},function innerWriteAbove(line){log(charmap.strafe+" "+line)})};function Iterator(set,start,end){this.set=set;this.prev=null;this.end=end;if(start){var next=this.set.findLeastGreaterThanOrEqual(start);if(next){this.set.splay(next.value);this.prev=next.getPrevious()}}}Iterator.prototype.next=function(){var next;if(this.prev){next=this.set.findLeastGreaterThan(this.prev.value)}else{next=this.set.findLeast()}if(!next){throw StopIteration}if(this.end!==undefined&&this.set.contentCompare(next.value,this.end)>=0){throw StopIteration}this.prev=next;return next.value}},{"./generic-collection":3,"./generic-set":6,"./listen/property-changes":9,"./listen/range-changes":10,"./shim":16,"./tree-log":18}],18:[function(require,module,exports){"use strict";module.exports=TreeLog;function TreeLog(){}TreeLog.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"};TreeLog.unicodeRound={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"╭",fromAbove:"╰",fromBoth:"┣",strafe:"┃"};TreeLog.unicodeSharp={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"┏",fromAbove:"┗",fromBoth:"┣",strafe:"┃"}},{}]},{},[1]);
